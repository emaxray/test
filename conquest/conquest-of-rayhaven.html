<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Conquest of Rayhaven - The Library of Rayhaven</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Uncial+Antiqua&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cinzel', serif;
            background: #1a1a1a;
            color: #d4af37;
            min-height: 100vh;
            display: flex;
            background-image: 
                radial-gradient(ellipse at top, #2a2a2a, transparent),
                radial-gradient(ellipse at bottom, #1a0f0a, transparent);
            overflow-x: hidden;
            position: relative;
            font-size: 12px;
        }
        
        /* Candlelight effect overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(255, 147, 41, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 70% 30%, rgba(255, 183, 77, 0.1) 0%, transparent 40%),
                        radial-gradient(circle at 50% 80%, rgba(255, 140, 0, 0.12) 0%, transparent 45%);
            pointer-events: none;
            mix-blend-mode: overlay;
            animation: flicker 4s ease-in-out infinite;
            z-index: 1;
        }
        
        @keyframes flicker {
            0%, 100% { opacity: 0.8; }
            25% { opacity: 0.9; }
            50% { opacity: 0.75; }
            75% { opacity: 0.85; }
        }
        
        /* Back Button */
        .back-button {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(139, 105, 20, 0.3);
            border: 2px solid #8b6914;
            color: #d4af37;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 13px;
            transition: all 0.3s ease;
            z-index: 100;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
            transform: translateX(-5px);
        }
        
        /* Left Sidebar */
        .left-sidebar {
            width: 220px;
            background: linear-gradient(180deg, #2a1810 0%, #1a0f0a 100%);
            border-right: 2px solid #8b6914;
            box-shadow: 2px 0 10px rgba(0,0,0,0.5);
            overflow-y: auto;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            transition: transform 0.3s ease;
            z-index: 100;
            transform: translateX(-220px);
        }
        
        .left-sidebar.expanded {
            transform: translateX(0);
        }
        
        /* Sidebar Toggle Buttons */
        .sidebar-toggle {
            position: fixed;
            width: 40px;
            height: 100px;
            background: linear-gradient(180deg, #2a1810 0%, #1a0f0a 100%);
            border: 2px solid #8b6914;
            color: #d4af37;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-family: 'Uncial Antiqua', cursive;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 99;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .left-toggle {
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 0 10px 10px 0;
            border-left: none;
        }
        
        .sidebar-toggle:hover {
            background: linear-gradient(180deg, #3a2418 0%, #2a1810 100%);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            width: 50px;
        }
        
        .sidebar-toggle:active {
            transform: translateY(-50%) scale(0.95);
        }
        
        /* Overlay for mobile/tablet */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 98;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #8b6914;
            position: relative;
        }
        
        .close-btn {
            background: rgba(139, 105, 20, 0.3);
            border: 1px solid #8b6914;
            color: #d4af37;
            width: 35px;
            height: 35px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 20px;
        }
        
        .close-btn:hover {
            background: rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .sidebar-content {
            padding: 15px;
        }
        
        .nav-item {
            display: block;
            padding: 10px 12px;
            margin: 6px 0;
            background: rgba(139, 105, 20, 0.2);
            border: 1px solid #8b6914;
            border-radius: 5px;
            text-decoration: none;
            color: #d4af37;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .nav-item::before {
            content: '‚óÜ';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: all 0.3s ease;
            color: #f4e4bc;
        }
        
        .nav-item:hover::before {
            opacity: 1;
        }
        
        .nav-item:hover {
            background: rgba(212, 175, 55, 0.3);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: rgba(212, 175, 55, 0.4);
            border-color: #f4e4bc;
        }
        
        .sidebar-title {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 16px;
            color: #f4e4bc;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            flex: 1;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px 10px;
            margin: 0 50px;
            position: relative;
            z-index: 2;
        }
        
        .conquest-title {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 32px;
            text-align: center;
            margin-bottom: 10px;
            color: #f4e4bc;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 0 0 20px rgba(212, 175, 55, 0.5); }
            to { text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 0 0 30px rgba(212, 175, 55, 0.8); }
        }
        
        .subtitle {
            font-size: 14px;
            text-align: center;
            margin-bottom: 20px;
            color: #b8860b;
        }
        
        /* Tab Navigation */
        .tab-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: rgba(139, 105, 20, 0.3);
            border: 2px solid #8b6914;
            color: #d4af37;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tab-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 215, 0, 0.1) 50%, transparent 70%);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }
        
        .tab-btn:hover::before {
            opacity: 1;
            top: -100%;
            left: -100%;
        }
        
        .tab-btn:hover {
            background: rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: rgba(212, 175, 55, 0.5);
            border-color: #f4e4bc;
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.6);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Teams Grid */
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .team-card {
            background: linear-gradient(135deg, rgba(42, 30, 20, 0.9) 0%, rgba(26, 15, 10, 0.9) 100%);
            border: 2px solid #8b6914;
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .team-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #d4af37, transparent);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }
        
        .team-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }
        
        /* Team specific colors */
        /* Jiggle Boggle - Green */
        .team-jiggleBoggle { border-color: #81c784; }
        .team-jiggleBoggle .team-name { color: #81c784; }
        .team-jiggleBoggle .team-rank { background: #81c784; }
        
        /* Pinkie - Pink */
        .team-pinkie { border-color: #f06292; }
        .team-pinkie .team-name { color: #f06292; }
        .team-pinkie .team-rank { background: #f06292; }
        
        /* Handsome Joon - Red */
        .team-handsomeJoon { border-color: #ff6b6b; }
        .team-handsomeJoon .team-name { color: #ff6b6b; }
        .team-handsomeJoon .team-rank { background: #ff6b6b; }
        
        /* Bomi - Yellow */
        .team-bomi { border-color: #ffd54f; }
        .team-bomi .team-name { color: #ffd54f; }
        .team-bomi .team-rank { background: #ffd54f; }
        
        /* Genius Irene - Blue */
        .team-geniusIrene { border-color: #4fc3f7; }
        .team-geniusIrene .team-name { color: #4fc3f7; }
        .team-geniusIrene .team-rank { background: #4fc3f7; }
        
        /* Pretty Eggplant - Purple */
        .team-prettyEggplant { border-color: #ba68c8; }
        .team-prettyEggplant .team-name { color: #ba68c8; }
        .team-prettyEggplant .team-rank { background: #ba68c8; }
        
        /* Rank Info Button */
        .rank-info-btn {
            position: fixed;
            top: 55px;
            left: 10px;
            background: rgba(139, 105, 20, 0.3);
            border: 2px solid #8b6914;
            color: #d4af37;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 13px;
            transition: all 0.3s ease;
            z-index: 100;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .rank-info-btn:hover {
            background: rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }
        
        /* Baron styling - Special styling for team leaders */
        .baron-item {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(180, 140, 40, 0.4) 100%) !important;
            border: 2px solid #ffd700 !important;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
        }
        
        .baron-item .student-name {
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
        
        /* Rank Info Modal */
        .rank-info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1100;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 10px;
        }
        
        .rank-info-content {
            background: linear-gradient(180deg, #2a1810 0%, #1a0f0a 100%);
            border: 3px solid #8b6914;
            border-radius: 12px;
            padding: 20px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.6);
            position: relative;
        }
        
        .rank-info-title {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
            color: #f4e4bc;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .rank-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 11px;
        }
        
        .rank-table th {
            background: rgba(212, 175, 55, 0.3);
            color: #f4e4bc;
            padding: 10px;
            text-align: left;
            font-size: 14px;
            border: 1px solid #8b6914;
        }
        
        .rank-table td {
            padding: 10px;
            border: 1px solid rgba(139, 105, 20, 0.5);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .rank-table tr:hover td {
            background: rgba(212, 175, 55, 0.1);
        }
        
        .tier-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 11px;
        }
        
        .tier-baron { background: #9400d3; color: #f4e4bc; }
        .tier-base { background: #654321; color: #f4e4bc; }
        .tier-2 { background: #c0c0c0; color: #1a0f0a; }
        .tier-3 { background: #cd853f; color: #1a0f0a; }
        .tier-4 { background: #ffd700; color: #1a0f0a; }
        
        .rank-name {
            font-weight: bold;
            font-size: 13px;
            color: #d4af37;
        }
        
        .rank-requirement {
            color: #b8860b;
            font-size: 11px;
            line-height: 1.4;
        }
        
        .close-info-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(139, 105, 20, 0.3);
            border: 1px solid #8b6914;
            color: #d4af37;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .close-info-btn:hover {
            background: rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .rank-branches {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .branch-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .branch-title {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 16px;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .class-change-note {
            background: rgba(139, 20, 20, 0.3);
            border: 2px solid #ff6b6b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }
        
        .class-change-note h4 {
            color: #ff6b6b;
            font-size: 16px;
            margin-bottom: 8px;
            font-family: 'Uncial Antiqua', cursive;
        }
        
        /* Human Shield styling */
        .human-shield-item {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(101, 67, 33, 0.3) 100%) !important;
            border: 1px solid #8b4513 !important;
            opacity: 0.8;
        }
        
        .human-shield-item .student-name {
            color: #cd853f;
            font-style: italic;
        }
        
        .human-shield-item .rank-select {
            background: rgba(139, 69, 19, 0.3);
            border-color: #8b4513;
            color: #cd853f;
        }
        
        /* Land controls */
        .land-stat {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(212, 175, 55, 0.5);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            position: relative;
        }
        
        .land-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }
        
        .land-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }
        
        .land-btn {
            background: rgba(212, 175, 55, 0.3);
            border: 1px solid #d4af37;
            color: #d4af37;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .land-btn:hover {
            background: #d4af37;
            color: #1a0f0a;
        }
        
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .team-name {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 18px;
            font-weight: bold;
        }
        
        .team-rank {
            font-size: 16px;
            color: #1a0f0a;
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .team-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .stat-label {
            font-size: 10px;
            color: #b8860b;
            margin-bottom: 3px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 14px;
            font-weight: bold;
            color: #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .gold-stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: center;
        }
        
        .gold-stat-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .rank-stats {
            display: flex;
            flex-direction: column;
            gap: 3px;
            font-size: 11px;
        }
        
        .rank-count {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .coin-icon {
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, #ffd700, #b8860b);
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            position: relative;
        }
        
        .coin-icon::after {
            content: '‚Çπ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #8b4513;
            font-weight: bold;
            font-size: 10px;
        }
        
        .students-section {
            margin-top: 15px;
        }
        
        .students-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .students-title {
            font-size: 14px;
            color: #d4af37;
        }
        
        .add-student-btn {
            background: rgba(212, 175, 55, 0.3);
            border: 1px solid #d4af37;
            color: #d4af37;
            padding: 6px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }
        
        .add-student-btn:hover {
            background: rgba(212, 175, 55, 0.5);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .students-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        
        .student-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(139, 105, 20, 0.5);
            border-radius: 6px;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 5px;
            transition: all 0.3s ease;
            min-height: 36px;
        }
        
        .student-item:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: #d4af37;
            transform: translateY(-1px);
        }
        
        .student-info {
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
            min-width: 0;
        }
        
        .student-name {
            font-size: 10px;
            color: #f4e4bc;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .student-rank {
            font-size: 16px;
            cursor: pointer;
            padding: 2px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .student-rank:hover {
            background: rgba(212, 175, 55, 0.3);
        }
        
        .rank-icon {
            display: inline-block;
            width: 20px;
            text-align: center;
        }
        
        .rank-select {
            background: rgba(139, 105, 20, 0.3);
            border: 1px solid #8b6914;
            color: #d4af37;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 10px;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            width: 100%;
        }
        
        .rank-select option {
            background: #2a1810;
            color: #f4e4bc;
        }
        
        .student-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .student-points {
            font-size: 11px;
            font-weight: bold;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        /* Points Controls */
        .points-controls {
            display: flex;
            gap: 2px;
        }
        
        .points-btn {
            background: rgba(212, 175, 55, 0.3);
            border: 1px solid #d4af37;
            color: #d4af37;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .points-btn:hover {
            background: #d4af37;
            color: #1a0f0a;
        }
        
        /* Shop Link Button */
        .shop-link {
            display: block;
            width: 250px;
            margin: 30px auto;
            padding: 15px;
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            border: none;
            border-radius: 25px;
            color: #1a0f0a;
            font-family: 'Uncial Antiqua', cursive;
            font-size: 18px;
            text-align: center;
            text-decoration: none;
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
            transition: all 0.3s ease;
        }
        
        .shop-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(212, 175, 55, 0.6);
        }
        
        /* Statistics Tab */
        .stats-container {
            background: rgba(42, 30, 20, 0.5);
            border: 2px solid #8b6914;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .leaderboard {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(212, 175, 55, 0.1);
        }
        
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        
        .leaderboard-rank {
            font-size: 18px;
            font-weight: bold;
            color: #d4af37;
            min-width: 40px;
        }
        
        .leaderboard-team {
            flex: 1;
            font-size: 14px;
            margin-left: 15px;
            color: #f4e4bc;
        }
        
        .leaderboard-score {
            font-size: 16px;
            font-weight: bold;
            color: #ffd700;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(180deg, #2a1810 0%, #1a0f0a 100%);
            border: 2px solid #8b6914;
            border-radius: 8px;
            padding: 20px;
            width: 350px;
            max-width: 90%;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
        }
        
        .modal-title {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 20px;
            text-align: center;
            margin-bottom: 15px;
            color: #f4e4bc;
        }
        
        .modal input {
            width: 100%;
            padding: 8px;
            background: rgba(139, 105, 20, 0.2);
            border: 1px solid #8b6914;
            color: #f4e4bc;
            font-family: 'Cinzel', serif;
            font-size: 14px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .modal button {
            padding: 8px 20px;
            background: rgba(139, 105, 20, 0.3);
            border: 2px solid #8b6914;
            color: #d4af37;
            font-family: 'Cinzel', serif;
            font-size: 13px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal button:hover {
            background: rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            color: #1a0f0a;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.6);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
            font-size: 13px;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Save Controls */
        .save-controls {
            position: fixed;
            bottom: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            z-index: 50;
        }
        
        .save-btn {
            background: #d4af37;
            color: #1a0f0a;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: all 0.3s ease;
        }
        
        .save-btn.undo-btn {
            background: #9a7d2e;
        }
        
        .save-btn.undo-btn:hover:not(:disabled) {
            background: #b8972f;
        }
        
        .save-btn.undo-btn:disabled {
            background: #555;
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* iPad Mini specific adjustments */
        @media (max-width: 768px) and (orientation: portrait) {
            .main-content {
                margin: 0 45px;
                padding: 15px 5px;
            }
            
            .conquest-title {
                font-size: 28px;
            }
            
            .teams-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .students-grid {
                grid-template-columns: 1fr;
            }
            
            .rank-branches {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        @media (max-width: 1024px) and (orientation: landscape) {
            .teams-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .team-card {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Back Button -->
    <a href="/index.html" class="back-button">
        <span>‚Üê</span> Back to Library
    </a>
    
    <!-- Rank Info Button -->
    <button class="rank-info-btn" onclick="showRankInfo()">
        <span>üìú</span> Rank Info
    </button>
    
    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle left-toggle" onclick="toggleLeftSidebar()">Subjects</button>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebars()"></div>
    
    <!-- Left Sidebar -->
    <div class="left-sidebar" id="leftSidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Ancient Subjects</h2>
            <button class="close-btn" onclick="toggleLeftSidebar()">√ó</button>
        </div>
        <div class="sidebar-content">
            <a href="/index.html" class="nav-item">Library Hall</a>
            <a href="/vocab/vocab.html" class="nav-item">Vocabulary</a>
            <a href="/grammar/grammar.html" class="nav-item">Grammar</a>
            <a href="/listening/listening.html" class="nav-item">Listening</a>
            <a href="/debate/debate.html" class="nav-item">Debate</a>
            <a href="/essay/essay.html" class="nav-item">Essay</a>
            <a href="/novel/novel.html" class="nav-item">Novel</a>
            <a href="/reading/reading.html" class="nav-item">Reading</a>
            <a href="/ted/ted-hub.html" class="nav-item">TED</a>
            <a href="/science/science.html" class="nav-item">Science</a>
            <a href="/timer/timer.html" class="nav-item">Timer</a>
            <a href="/conquest/conquest-of-rayhaven.html" class="nav-item active">Conquest</a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <h1 class="conquest-title">Conquest of Rayhaven</h1>
        <p class="subtitle">Track thy team's glory and manage the scholar's treasury</p>
        
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('teams')">Team Rankings</button>
            <button class="tab-btn" onclick="switchTab('stats')">Battle Statistics</button>
        </div>
        
        <!-- Teams Tab -->
        <div id="teams" class="tab-content active">
            <div class="teams-grid" id="teamsGrid">
                <!-- Teams will be generated dynamically -->
            </div>
            
            <!-- Shop Link -->
            <a href="/conquest/shop.html" class="shop-link">
                Visit the Merchant's Shop ‚Üí
            </a>
        </div>
        
        <!-- Statistics Tab -->
        <div id="stats" class="tab-content">
            <div class="stats-container">
                <h2 style="text-align: center; color: #d4af37; margin-bottom: 20px; font-size: 20px;">Team Leaderboard</h2>
                <div class="leaderboard" id="leaderboard">
                    <!-- Leaderboard will be generated dynamically -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Add New Scholar</h3>
            <input type="text" id="studentNameInput" placeholder="Enter scholar's name...">
            <input type="number" id="studentPointsInput" placeholder="Starting points (default: 0)">
            <div class="modal-buttons">
                <button onclick="confirmAddStudent()">Add Scholar</button>
                <button onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Save Controls -->
    <div class="save-controls">
        <button class="save-btn undo-btn" onclick="undoLastAction()" disabled>‚Ü∂ Undo</button>
        <button class="save-btn" onclick="saveData()">üíæ Save</button>
        <button class="save-btn" onclick="resetData()">üîÑ Reset</button>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>
    
    <!-- Rank Information Modal -->
    <div id="rankInfoModal" class="rank-info-modal">
        <div class="rank-info-content">
            <button class="close-info-btn" onclick="closeRankInfo()">√ó</button>
            <h2 class="rank-info-title">Military Rank System</h2>
            
            <table class="rank-table">
                <thead>
                    <tr>
                        <th>Tier</th>
                        <th>Ranks</th>
                        <th>Requirements</th>
                        <th>Combat Bonuses</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="tier-badge tier-baron">Special</span></td>
                        <td><span class="rank-name">üëë Baron</span></td>
                        <td><span class="rank-requirement">Master of Domain<br>(Team Leader)</span></td>
                        <td><span class="rank-requirement">Leadership bonuses<br>+Team morale</span></td>
                    </tr>
                    <tr>
                        <td><span class="tier-badge" style="background: #8b4513; color: #f4e4bc;">Starter</span></td>
                        <td><span class="rank-name">ü•© Human Shield</span></td>
                        <td><span class="rank-requirement">Under 500 Gold</span></td>
                        <td><span class="rank-requirement" style="color: #cd853f;">No bonuses<br>(Meat shield for others)</span></td>
                    </tr>
                    <tr>
                        <td><span class="tier-badge tier-base">Base</span></td>
                        <td><span class="rank-name">üåæ Peasant Soldier</span></td>
                        <td><span class="rank-requirement">500 Gold</span></td>
                        <td><span class="rank-requirement">No combat bonuses</span></td>
                    </tr>
                    <tr>
                        <td rowspan="3"><span class="tier-badge tier-2">Tier 2</span></td>
                        <td><span class="rank-name">üó°Ô∏è Spearman</span></td>
                        <td rowspan="3"><span class="rank-requirement">1,000 Gold</span></td>
                        <td><span class="rank-requirement" style="color: #ff6b6b;">+5 Attack Power</span></td>
                    </tr>
                    <tr>
                        <td><span class="rank-name">üõ°Ô∏è Shield Bearer</span></td>
                        <td><span class="rank-requirement" style="color: #4fc3f7;">+5 Defense Power</span></td>
                    </tr>
                    <tr>
                        <td><span class="rank-name">üèπ Archer</span></td>
                        <td><span class="rank-requirement" style="color: #81c784;">+2 Attack / +2 Defense</span></td>
                    </tr>
                    <tr>
                        <td rowspan="3"><span class="tier-badge tier-3">Tier 3</span></td>
                        <td><span class="rank-name">‚öúÔ∏è Squire</span></td>
                        <td rowspan="3"><span class="rank-requirement">3,000 Gold<br>+ 100 on 1 vocab test</span></td>
                        <td><span class="rank-requirement" style="color: #ff6b6b;">+10 Attack Power</span></td>
                    </tr>
                    <tr>
                        <td><span class="rank-name">üö© Banner-man</span></td>
                        <td><span class="rank-requirement" style="color: #4fc3f7;">+10 Defense Power</span></td>
                    </tr>
                    <tr>
                        <td><span class="rank-name">ü¶Ö Scout</span></td>
                        <td><span class="rank-requirement" style="color: #81c784;">+5 Attack / +5 Defense</span></td>
                    </tr>
                    <tr>
                        <td rowspan="3"><span class="tier-badge tier-4">Tier 4</span></td>
                        <td><span class="rank-name">‚öîÔ∏è Knight</span></td>
                        <td rowspan="3"><span class="rank-requirement">5,000 Gold<br>+ 100 on 3 vocab tests<br>(in a row)</span></td>
                        <td><span class="rank-requirement" style="color: #ff6b6b;">+20 Attack Power</span></td>
                    </tr>
                    <tr>
                        <td><span class="rank-name">üè¥ Banneret</span></td>
                        <td><span class="rank-requirement" style="color: #4fc3f7;">+20 Defense Power</span></td>
                    </tr>
                    <tr>
                        <td><span class="rank-name">üêé Cavalry</span></td>
                        <td><span class="rank-requirement" style="color: #81c784;">+10 Attack / +10 Defense</span></td>
                    </tr>
                </tbody>
            </table>
            
            <h3 style="text-align: center; color: #d4af37; margin: 20px 0 15px; font-size: 18px;">Choose Your Path</h3>
            
            <div class="rank-branches">
                <div class="branch-card" style="border-color: #ff6b6b;">
                    <h4 class="branch-title" style="color: #ff6b6b;">‚öîÔ∏è Warrior Path</h4>
                    <p class="branch-description" style="font-size: 11px;">
                        Spearman ‚Üí Squire ‚Üí Knight<br>
                        Masters of direct combat and honor
                    </p>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255, 107, 107, 0.3);">
                        <p style="color: #ff6b6b; font-size: 13px; font-weight: bold;">Attack Power Bonuses:</p>
                        <p style="color: #ff9999; font-size: 11px;">Tier 2: +5 Attack</p>
                        <p style="color: #ff9999; font-size: 11px;">Tier 3: +10 Attack</p>
                        <p style="color: #ff9999; font-size: 11px;">Tier 4: +20 Attack</p>
                    </div>
                </div>
                <div class="branch-card" style="border-color: #4fc3f7;">
                    <h4 class="branch-title" style="color: #4fc3f7;">üõ°Ô∏è Defender Path</h4>
                    <p class="branch-description" style="font-size: 11px;">
                        Shield Bearer ‚Üí Banner-man ‚Üí Banneret<br>
                        Protectors and standard bearers
                    </p>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(79, 195, 247, 0.3);">
                        <p style="color: #4fc3f7; font-size: 13px; font-weight: bold;">Defense Power Bonuses:</p>
                        <p style="color: #87ceeb; font-size: 11px;">Tier 2: +5 Defense</p>
                        <p style="color: #87ceeb; font-size: 11px;">Tier 3: +10 Defense</p>
                        <p style="color: #87ceeb; font-size: 11px;">Tier 4: +20 Defense</p>
                    </div>
                </div>
                <div class="branch-card" style="border-color: #81c784;">
                    <h4 class="branch-title" style="color: #81c784;">üèπ Ranger Path</h4>
                    <p class="branch-description" style="font-size: 11px;">
                        Archer ‚Üí Scout ‚Üí Cavalry<br>
                        Masters of speed and precision
                    </p>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(129, 199, 132, 0.3);">
                        <p style="color: #81c784; font-size: 13px; font-weight: bold;">Balanced Bonuses:</p>
                        <p style="color: #a8d5a8; font-size: 11px;">Tier 2: +2 Attack / +2 Defense</p>
                        <p style="color: #a8d5a8; font-size: 11px;">Tier 3: +5 Attack / +5 Defense</p>
                        <p style="color: #a8d5a8; font-size: 11px;">Tier 4: +10 Attack / +10 Defense</p>
                    </div>
                </div>
            </div>
            
            <div class="class-change-note">
                <h4>‚ö†Ô∏è Class Change Requirement</h4>
                <p style="font-size: 11px;">To change your combat path midway, you must achieve<br><strong>100% on ALL homework assignments for that day</strong></p>
            </div>
        </div>
    </div>
    
    <script>
        // Team and Student Data
        let teamData = {
            'jiggleBoggle': {
                name: 'Jiggle Boggle',
                land: 5,
                goldSpent: 0,
                baron: 'Gabin',
                students: [
                    { name: 'Gabin', points: 1085, rank: 'Peasant Soldier' },
                    { name: 'Jihoo', points: 880, rank: 'Peasant Soldier' },
                    { name: 'Emma', points: 875, rank: 'Peasant Soldier' },
                    { name: 'Shawn', points: 385, rank: 'Peasant Soldier' },
                    { name: 'Dave', points: 1215, rank: 'Peasant Soldier' },
                    { name: 'Ejoon', points: 115, rank: 'Peasant Soldier' },
                    { name: 'Allen', points: 410, rank: 'Peasant Soldier' },
                    { name: 'Rina', points: 115, rank: 'Peasant Soldier' },
                    { name: 'Aiden P', points: 220, rank: 'Peasant Soldier' },
                    { name: 'Tommy', points: 170, rank: 'Peasant Soldier' },
                    { name: 'Daniel P', points: 495, rank: 'Peasant Soldier' },
                    { name: 'Emily B', points: 110, rank: 'Peasant Soldier' },
                    { name: 'Leo', points: 35, rank: 'Peasant Soldier' },
                    { name: 'Jacob', points: 250, rank: 'Peasant Soldier' },
                    { name: 'Donation', points: 300, rank: 'Treasury' }
                ]
            },
            'pinkie': {
                name: 'Pinkie',
                land: 5,
                goldSpent: 0,
                baron: 'Lilly',
                students: [
                    { name: 'Lilly', points: 365, rank: 'Peasant Soldier' },
                    { name: 'Jayden', points: 630, rank: 'Peasant Soldier' },
                    { name: 'Warren', points: 830, rank: 'Peasant Soldier' },
                    { name: 'Kelly', points: 660, rank: 'Peasant Soldier' },
                    { name: 'Hyunny', points: 700, rank: 'Peasant Soldier' },
                    { name: 'Julie', points: 340, rank: 'Peasant Soldier' },
                    { name: 'Laura', points: 560, rank: 'Peasant Soldier' },
                    { name: 'Jiyoo', points: 330, rank: 'Peasant Soldier' },
                    { name: 'Sunny', points: 210, rank: 'Peasant Soldier' },
                    { name: 'Xion', points: 375, rank: 'Peasant Soldier' },
                    { name: 'Chloe S', points: 305, rank: 'Peasant Soldier' },
                    { name: 'June Y', points: 355, rank: 'Peasant Soldier' },
                    { name: 'Andy', points: 115, rank: 'Peasant Soldier' },
                    { name: 'Jack', points: 45, rank: 'Peasant Soldier' },
                    { name: 'Donation', points: 800, rank: 'Treasury' }
                ]
            },
            'handsomeJoon': {
                name: 'Handsome Joon',
                land: 5,
                goldSpent: 0,
                baron: 'Joon',
                students: [
                    { name: 'Joon', points: 1545, rank: 'Peasant Soldier' },
                    { name: 'Angel', points: 1105, rank: 'Peasant Soldier' },
                    { name: 'Lily K', points: 700, rank: 'Peasant Soldier' },
                    { name: 'Junmin', points: 855, rank: 'Peasant Soldier' },
                    { name: 'Siyun', points: 1135, rank: 'Peasant Soldier' },
                    { name: 'Yoojun', points: 175, rank: 'Peasant Soldier' },
                    { name: 'Taeyoon', points: 235, rank: 'Peasant Soldier' },
                    { name: 'Yena', points: 385, rank: 'Peasant Soldier' },
                    { name: 'Ian', points: 205, rank: 'Peasant Soldier' },
                    { name: 'Kevin L', points: 365, rank: 'Peasant Soldier' },
                    { name: 'Chris DHK', points: 345, rank: 'Peasant Soldier' },
                    { name: 'Olivia', points: 110, rank: 'Peasant Soldier' },
                    { name: 'Cindy', points: 150, rank: 'Peasant Soldier' },
                    { name: 'Donation', points: 1175, rank: 'Treasury' }
                ]
            },
            'bomi': {
                name: 'Bomi',
                land: 5,
                goldSpent: 0,
                baron: 'Ellie N',
                students: [
                    { name: 'Ellie N', points: 1430, rank: 'Peasant Soldier' },
                    { name: 'Azaline', points: 1175, rank: 'Peasant Soldier' },
                    { name: 'Roy SRK', points: 645, rank: 'Peasant Soldier' },
                    { name: 'Emily P', points: 990, rank: 'Peasant Soldier' },
                    { name: 'Eric', points: 630, rank: 'Peasant Soldier' },
                    { name: 'Seil', points: 405, rank: 'Peasant Soldier' },
                    { name: 'Isabella', points: 555, rank: 'Peasant Soldier' },
                    { name: 'Max', points: 335, rank: 'Peasant Soldier' },
                    { name: 'Jenny', points: 205, rank: 'Peasant Soldier' },
                    { name: 'Elon', points: 120, rank: 'Peasant Soldier' },
                    { name: 'Chelsea', points: 380, rank: 'Peasant Soldier' },
                    { name: 'Chloe P', points: 200, rank: 'Peasant Soldier' },
                    { name: 'Gio', points: 25, rank: 'Peasant Soldier' },
                    { name: 'Aaron', points: 0, rank: 'Peasant Soldier' },
                    { name: 'Donation', points: 920, rank: 'Treasury' }
                ]
            },
            'geniusIrene': {
                name: 'Genius Irene',
                land: 5,
                goldSpent: 0,
                baron: 'Irene',
                students: [
                    { name: 'Irene', points: 855, rank: 'Peasant Soldier' },
                    { name: 'Bosco', points: 440, rank: 'Peasant Soldier' },
                    { name: 'Juha', points: 385, rank: 'Peasant Soldier' },
                    { name: 'Jaewon', points: 685, rank: 'Peasant Soldier' },
                    { name: 'Gabriel', points: 485, rank: 'Peasant Soldier' },
                    { name: 'Hajun', points: 225, rank: 'Peasant Soldier' },
                    { name: 'Daniel S', points: 510, rank: 'Peasant Soldier' },
                    { name: 'Luna', points: 575, rank: 'Peasant Soldier' },
                    { name: 'Lucas', points: 605, rank: 'Peasant Soldier' },
                    { name: 'Chan', points: 490, rank: 'Peasant Soldier' },
                    { name: 'Jia', points: 275, rank: 'Peasant Soldier' },
                    { name: 'Yuna', points: 35, rank: 'Peasant Soldier' },
                    { name: 'Ellie P', points: 0, rank: 'Peasant Soldier' },
                    { name: 'Stella', points: 20, rank: 'Peasant Soldier' },
                    { name: 'Donation', points: 660, rank: 'Treasury' }
                ]
            },
            'prettyEggplant': {
                name: 'Pretty Eggplant',
                land: 5,
                goldSpent: 0,
                baron: 'Anna',
                students: [
                    { name: 'Anna', points: 810, rank: 'Peasant Soldier' },
                    { name: 'Doyoon', points: 965, rank: 'Peasant Soldier' },
                    { name: 'Violet', points: 870, rank: 'Peasant Soldier' },
                    { name: 'Roy JWK', points: 260, rank: 'Peasant Soldier' },
                    { name: 'Gavin', points: 190, rank: 'Peasant Soldier' },
                    { name: 'Aiden L', points: 375, rank: 'Peasant Soldier' },
                    { name: 'Sophia', points: 360, rank: 'Peasant Soldier' },
                    { name: 'June K', points: 715, rank: 'Peasant Soldier' },
                    { name: 'Siwon', points: 230, rank: 'Peasant Soldier' },
                    { name: 'Chris JHK', points: 790, rank: 'Peasant Soldier' },
                    { name: 'Trevor', points: 650, rank: 'Peasant Soldier' },
                    { name: 'Lily P', points: 725, rank: 'Peasant Soldier' },
                    { name: 'Branden', points: 0, rank: 'Peasant Soldier' },
                    { name: 'Jason', points: 0, rank: 'Peasant Soldier' },
                    { name: 'Donation', points: 525, rank: 'Treasury' }
                ]
            }
        };
        
        // Undo history
        let undoHistory = [];
        const MAX_UNDO_HISTORY = 10;
        
        // Save state for undo
        function saveUndoState(action) {
            undoHistory.push({
                action: action,
                data: JSON.parse(JSON.stringify(teamData)),
                timestamp: new Date().toISOString()
            });
            
            // Keep only last MAX_UNDO_HISTORY states
            if (undoHistory.length > MAX_UNDO_HISTORY) {
                undoHistory.shift();
            }
            
            updateUndoButton();
        }
        
        // Undo last action
        function undoLastAction() {
            if (undoHistory.length > 0) {
                const lastState = undoHistory.pop();
                teamData = JSON.parse(JSON.stringify(lastState.data));
                updateDisplay();
                saveData();
                showToast(`Undone: ${lastState.action}`);
                updateUndoButton();
            }
        }
        
        // Update undo button state
        function updateUndoButton() {
            const undoBtn = document.querySelector('.undo-btn');
            if (undoBtn) {
                undoBtn.disabled = undoHistory.length === 0;
                if (undoHistory.length > 0) {
                    const lastAction = undoHistory[undoHistory.length - 1].action;
                    undoBtn.title = `Undo: ${lastAction}`;
                } else {
                    undoBtn.title = 'Nothing to undo';
                }
            }
        }
        
        let currentTeamForStudent = null;
        
        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('conquestTeamData');
            if (savedData) {
                teamData = JSON.parse(savedData);
            }
            updateDisplay();
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('conquestTeamData', JSON.stringify(teamData));
            
            // Also save individual student data for compatibility with other pages
            const studentList = [];
            Object.values(teamData).forEach(team => {
                team.students.forEach(student => {
                    if (student.name !== 'Donation') {
                        studentList.push({
                            id: student.name.toLowerCase().replace(/\s+/g, '-'),
                            name: student.name,
                            points: student.points
                        });
                    }
                });
            });
            
            localStorage.setItem('studentList', JSON.stringify(studentList));
            
            // Update studentPoints for compatibility
            const pointsObj = {};
            studentList.forEach(student => {
                pointsObj[student.id] = student.points;
            });
            localStorage.setItem('studentPoints', JSON.stringify(pointsObj));
            
            // Save in format compatible with treasury
            localStorage.setItem('treasuryStudents', JSON.stringify(studentList.map(s => ({
                name: s.name,
                points: s.points
            }))));
            
            // Save student names for streamlined version
            const names = studentList.map(s => s.name);
            localStorage.setItem("studentNames", JSON.stringify(names));
            
            showToast('Progress saved!');
        }
        
        // Reset data
        function resetData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone!')) {
                localStorage.removeItem('conquestTeamData');
                localStorage.removeItem('studentList');
                localStorage.removeItem('studentPoints');
                localStorage.removeItem('treasuryStudents');
                localStorage.removeItem('studentNames');
                location.reload();
            }
        }
        
        // Calculate team total points
        function calculateTeamTotal(students) {
            return students.reduce((total, student) => total + student.points, 0);
        }
        
        // Calculate team available gold (total points - gold spent)
        function calculateTeamGold(team) {
            const totalPoints = calculateTeamTotal(team.students);
            const goldSpent = team.goldSpent || 0;
            return totalPoints - goldSpent;
        }
        
        // Update points (points NEVER change from spending)
        function updatePoints(teamKey, studentIndex, amount) {
            const newPoints = teamData[teamKey].students[studentIndex].points + amount;
            if (newPoints >= 0) {
                saveUndoState(`Changed ${teamData[teamKey].students[studentIndex].name}'s points by ${amount}`);
                teamData[teamKey].students[studentIndex].points = newPoints;
                updateDisplay();
                saveData();
            }
        }
        
        // Update rank
        window.updateRank = function(teamKey, studentIndex) {
            const student = teamData[teamKey].students[studentIndex];
            const currentRank = student.rank || 'Peasant Soldier';
            
            // Define rank progression
            const ranks = [
                { name: 'Baron', icon: 'üëë' },
                { name: 'Human Shield', icon: 'ü•©' },
                { name: 'Peasant Soldier', icon: 'üåæ' },
                { name: 'Spearman', icon: 'üó°Ô∏è' },
                { name: 'Shield Bearer', icon: 'üõ°Ô∏è' },
                { name: 'Archer', icon: 'üèπ' },
                { name: 'Squire', icon: '‚öúÔ∏è' },
                { name: 'Banner-man', icon: 'üö©' },
                { name: 'Scout', icon: 'ü¶Ö' },
                { name: 'Knight', icon: '‚öîÔ∏è' },
                { name: 'Banneret', icon: 'üè¥' },
                { name: 'Cavalry', icon: 'üêé' }
            ];
            
            // Find current rank index
            let currentIndex = ranks.findIndex(r => r.name === currentRank);
            if (currentIndex === -1) currentIndex = 2; // Default to Peasant Soldier
            
            // Cycle to next rank
            const nextIndex = (currentIndex + 1) % ranks.length;
            const newRank = ranks[nextIndex].name;
            
            saveUndoState(`Changed ${student.name}'s rank to ${newRank}`);
            teamData[teamKey].students[studentIndex].rank = newRank;
            
            // If setting someone as Baron, update team baron
            if (newRank === 'Baron') {
                teamData[teamKey].baron = student.name;
            }
            
            updateDisplay();
            saveData();
        }
        
        // Get rank icon
        function getRankIcon(rank) {
            const rankIcons = {
                'Baron': 'üëë',
                'Human Shield': 'ü•©',
                'Peasant Soldier': 'üåæ',
                'Spearman': 'üó°Ô∏è',
                'Shield Bearer': 'üõ°Ô∏è',
                'Archer': 'üèπ',
                'Squire': '‚öúÔ∏è',
                'Banner-man': 'üö©',
                'Scout': 'ü¶Ö',
                'Knight': '‚öîÔ∏è',
                'Banneret': 'üè¥',
                'Cavalry': 'üêé',
                'Treasury': 'üí∞'
            };
            return rankIcons[rank] || 'üåæ';
        }
        
        // Count ranks in team
        function countRanks(team) {
            const rankCounts = {};
            team.students.forEach(student => {
                if (student.name !== 'Donation') {
                    const rank = student.rank || 'Peasant Soldier';
                    rankCounts[rank] = (rankCounts[rank] || 0) + 1;
                }
            });
            return rankCounts;
        }
        
        // Remove student
        window.removeStudent = function(teamKey, studentIndex) {
            const student = teamData[teamKey].students[studentIndex];
            if (student.name !== 'Donation') {
                if (confirm(`Remove ${student.name} from ${teamData[teamKey].name}? Their ${student.points} points will be added to the donation treasury.`)) {
                    saveUndoState(`Removed ${student.name} (${student.points} points)`);
                    
                    // Add points to donation
                    if (student.points > 0) {
                        let donationIndex = teamData[teamKey].students.findIndex(s => s.name === 'Donation');
                        if (donationIndex === -1) {
                            teamData[teamKey].students.push({ name: 'Donation', points: 0, rank: 'Treasury' });
                            donationIndex = teamData[teamKey].students.length - 1;
                        }
                        teamData[teamKey].students[donationIndex].points += student.points;
                    }
                    
                    // Remove the student
                    teamData[teamKey].students.splice(studentIndex, 1);
                    
                    updateDisplay();
                    saveData();
                    showToast(`${student.name} has been removed from ${teamData[teamKey].name}.`);
                }
            }
        }
        
        // Update land count
        function updateLand(teamKey, amount) {
            const newLand = teamData[teamKey].land + amount;
            if (newLand >= 0) {
                saveUndoState(`Changed ${teamData[teamKey].name}'s land by ${amount}`);
                teamData[teamKey].land = newLand;
                updateDisplay();
                saveData();
            }
        }
        
        // Shop purchase deduction (for merchant shop compatibility)
        function deductTeamGold(teamKey, amount) {
            if (teamData[teamKey]) {
                const availableGold = calculateTeamGold(teamData[teamKey]);
                
                if (availableGold >= amount) {
                    // Increase goldSpent
                    teamData[teamKey].goldSpent = (teamData[teamKey].goldSpent || 0) + amount;
                    saveData();
                    updateDisplay();
                    return true; // Purchase successful
                }
            }
            return false; // Insufficient funds
        }
        
        // Get team treasury balance (available gold)
        function getTeamGold(teamKey) {
            if (teamData[teamKey]) {
                return calculateTeamGold(teamData[teamKey]);
            }
            return 0;
        }
        
        // Make functions globally available for shop page
        window.conquestShopAPI = {
            deductTeamGold,
            getTeamGold,
            getTeamData: () => teamData
        };
        
        // Show add student modal
        window.showAddStudent = function(teamKey) {
            currentTeamForStudent = teamKey;
            document.getElementById('addStudentModal').style.display = 'flex';
            document.getElementById('studentNameInput').value = '';
            document.getElementById('studentPointsInput').value = '';
            document.getElementById('studentNameInput').focus();
        }
        
        // Confirm add student
        window.confirmAddStudent = function() {
            const name = document.getElementById('studentNameInput').value.trim();
            const points = parseInt(document.getElementById('studentPointsInput').value) || 0;
            
            if (name && currentTeamForStudent) {
                saveUndoState(`Added ${name} to ${teamData[currentTeamForStudent].name}`);
                const rank = points < 500 ? 'Human Shield' : 'Peasant Soldier';
                teamData[currentTeamForStudent].students.push({ name, points, rank });
                updateDisplay();
                saveData();
                showToast(`${name} added to ${teamData[currentTeamForStudent].name}!`);
            }
            
            closeModal();
        }
        
        // Close modal
        window.closeModal = function() {
            document.getElementById('addStudentModal').style.display = 'none';
            currentTeamForStudent = null;
        }
        
        // Generate team cards
        function generateTeamCards() {
            const teamsGrid = document.getElementById('teamsGrid');
            teamsGrid.innerHTML = '';
            
            // Calculate rankings
            const rankings = Object.entries(teamData)
                .map(([key, team]) => ({
                    key,
                    team,
                    total: calculateTeamTotal(team.students)
                }))
                .sort((a, b) => b.total - a.total);
            
            rankings.forEach(({ key, team, total }, index) => {
                const teamCard = document.createElement('div');
                teamCard.className = `team-card team-${key}`;
                
                // Calculate students without donation
                const realStudents = team.students.filter(s => s.name !== 'Donation');
                const totalGold = calculateTeamGold(team);
                const goldSpent = team.goldSpent || 0;
                
                teamCard.innerHTML = `
                    <div class="team-header">
                        <div class="team-name">${team.name}</div>
                        <div class="team-rank">#${index + 1}</div>
                    </div>
                    
                    <div class="team-stats">
                        <div class="stat-box">
                            <div class="stat-label">Gold (Total/Available/Spent)</div>
                            <div class="gold-stats">
                                <div class="gold-stat-row">
                                    <span style="color: #ffd700;">${total}</span>
                                    <span style="color: #d4af37;">/</span>
                                    <span style="color: #81c784;">${totalGold}</span>
                                    <span style="color: #d4af37;">/</span>
                                    <span style="color: #ff6b6b;">${goldSpent}</span>
                                    <span class="coin-icon"></span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Land & Ranks</div>
                            <div class="rank-stats">
                                <div class="rank-count">
                                    <span>üè∞ ${team.land || 0}</span>
                                    <button class="land-btn" onclick="updateLand('${key}', -1)" style="width: 18px; height: 18px; font-size: 10px;">-</button>
                                    <button class="land-btn" onclick="updateLand('${key}', 1)" style="width: 18px; height: 18px; font-size: 10px;">+</button>
                                </div>
                                ${Object.entries(countRanks(team)).slice(0, 3).map(([rank, count]) => 
                                    `<div class="rank-count">${getRankIcon(rank)} ${count}</div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="students-section">
                        <div class="students-header">
                            <div class="students-title">Team Members (${realStudents.length})</div>
                            <button class="add-student-btn" onclick="showAddStudent('${key}')">+ Add</button>
                        </div>
                        <div class="students-grid">
                            ${team.students.map((student, idx) => {
                                const studentRank = student.rank || 'Peasant Soldier';
                                let itemClass = 'student-item';
                                
                                // Special styling for different ranks
                                if (student.name === team.baron || studentRank === 'Baron') {
                                    itemClass += ' baron-item';
                                } else if (studentRank === 'Human Shield' || (student.points < 500 && studentRank !== 'Baron')) {
                                    itemClass += ' human-shield-item';
                                }
                                
                                if (student.name === 'Donation') {
                                    return `
                                        <div class="${itemClass}" style="grid-column: span 2;">
                                            <div class="student-info">
                                                <span class="rank-icon">${getRankIcon('Treasury')}</span>
                                                <span class="student-name" style="font-weight: bold; color: #ffd700;">Team Treasury</span>
                                            </div>
                                            <div class="student-controls">
                                                <span class="student-points">
                                                    ${student.points}
                                                    <span class="coin-icon" style="width: 12px; height: 12px; font-size: 8px;"></span>
                                                </span>
                                            </div>
                                        </div>
                                    `;
                                } else {
                                    return `
                                        <div class="${itemClass}">
                                            <div class="student-info">
                                                <span class="student-rank rank-icon" onclick="updateRank('${key}', ${idx})" title="Click to change rank">
                                                    ${getRankIcon(studentRank)}
                                                </span>
                                                <span class="student-name">${student.name}</span>
                                            </div>
                                            <div class="student-controls">
                                                <span class="student-points">
                                                    ${student.points}
                                                    <span class="coin-icon" style="width: 12px; height: 12px; font-size: 8px;"></span>
                                                </span>
                                                <div class="points-controls">
                                                    <button class="points-btn" onclick="updatePoints('${key}', ${idx}, -10)">-</button>
                                                    <button class="points-btn" onclick="updatePoints('${key}', ${idx}, 10)">+</button>
                                                    <button class="points-btn" style="background: rgba(139, 20, 20, 0.3); border-color: #8b4514; font-size: 10px;" onclick="removeStudent('${key}', ${idx})" title="Remove">√ó</button>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }
                            }).join('')}
                        </div>
                    </div>
                `;
                
                teamsGrid.appendChild(teamCard);
            });
        }
        
        // Generate leaderboard
        function generateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = '';
            
            const rankings = Object.entries(teamData)
                .map(([key, team]) => ({
                    name: team.name,
                    total: calculateTeamTotal(team.students),
                    availableGold: calculateTeamGold(team),
                    goldSpent: team.goldSpent || 0,
                    land: team.land || 0
                }))
                .sort((a, b) => b.total - a.total);
            
            rankings.forEach(({ name, total, availableGold, goldSpent, land }, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.innerHTML = `
                    <div class="leaderboard-rank">#${index + 1}</div>
                    <div class="leaderboard-team">${name} (üè∞ ${land})</div>
                    <div class="leaderboard-score">
                        <span style="color: #ffd700;">${total}</span> / 
                        <span style="color: #81c784;">${availableGold}</span> / 
                        <span style="color: #ff6b6b;">${goldSpent}</span>
                        <span class="coin-icon"></span>
                    </div>
                `;
                leaderboard.appendChild(item);
            });
        }
        
        // Update display
        function updateDisplay() {
            generateTeamCards();
            if (document.getElementById('stats').classList.contains('active')) {
                generateLeaderboard();
            }
        }
        
        // Switch tabs
        window.switchTab = function(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Update content if switching to stats
            if (tabName === 'stats') {
                generateLeaderboard();
            }
        }
        
        // Show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Toggle sidebar
        window.toggleLeftSidebar = function() {
            const sidebar = document.getElementById('leftSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const isExpanded = sidebar.classList.contains('expanded');
            
            if (isExpanded) {
                sidebar.classList.remove('expanded');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('expanded');
                overlay.classList.add('active');
            }
        }
        
        window.closeSidebars = function() {
            document.getElementById('leftSidebar').classList.remove('expanded');
            document.getElementById('sidebarOverlay').classList.remove('active');
        }
        
        // Show rank info modal
        window.showRankInfo = function() {
            document.getElementById('rankInfoModal').style.display = 'flex';
        }
        
        // Close rank info modal
        window.closeRankInfo = function() {
            document.getElementById('rankInfoModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('addStudentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        document.getElementById('rankInfoModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeRankInfo();
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeRankInfo();
                closeSidebars();
            }
        });
        
        // Handle Enter key in modal
        document.getElementById('studentNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('studentPointsInput').focus();
            }
        });
        
        document.getElementById('studentPointsInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmAddStudent();
            }
        });
        
        // Handle touch events for better tablet experience
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const leftSidebar = document.getElementById('leftSidebar');
            
            if (touchEndX - touchStartX > swipeThreshold && touchStartX < 50) {
                leftSidebar.classList.add('expanded');
                document.getElementById('sidebarOverlay').classList.add('active');
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateUndoButton();
        });
        
        // Auto-save every 30 seconds
        setInterval(saveData, 30000);
    </script>
</body>
</html>
